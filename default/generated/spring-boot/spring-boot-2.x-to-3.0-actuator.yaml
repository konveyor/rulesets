- ruleID: spring-boot-2.x-to-3.0-actuator-00010
  category: mandatory
  effort: 2
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    or:
    - builtin.filecontent:
        pattern: "management.endpoints.jmx.exposure"
        filePattern: "application*.properties"
    - builtin.filecontent:
        pattern: "management.endpoints.web.exposure"
        filePattern: "application*.properties"
  description: Actuator endpoint exposure configuration has changed
  message: |
    Actuator endpoint exposure configuration has been updated in Spring Boot 3.0.

    **Key Changes:**
    - JMX endpoint exposure is now disabled by default
    - The `/actuator` endpoint path prefix is now mandatory
    - Health endpoint details show by default for authorized users

    **Review your configuration:**
    ```properties
    # JMX exposure (now off by default)
    management.endpoints.jmx.exposure.include=health,info

    # Web exposure
    management.endpoints.web.exposure.include=health,info,metrics

    # Health details visibility
    management.endpoint.health.show-details=when_authorized
    ```

    **Security Consideration:**
    Ensure actuator endpoints are properly secured in production environments.
  links:
    - title: 'Spring Boot 3.0 Migration Guide - Actuator Changes'
      url: https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#actuator-changes

- ruleID: spring-boot-2.x-to-3.0-actuator-00020
  category: mandatory
  effort: 3
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    java.referenced:
      pattern: org.springframework.boot.actuate.endpoint.annotation.Endpoint
      location: ANNOTATION
  description: Custom actuator endpoints may need updates for Spring Boot 3.0
  message: |
    Custom actuator endpoints may require updates for Spring Boot 3.0 compatibility.

    **Key Changes:**
    - Endpoint IDs must only contain alphanumeric characters
    - `@EndpointExtension` has been refined
    - Health indicators have updated interfaces

    **Example Custom Endpoint:**
    ```java
    @Component
    @Endpoint(id = "custom")  // ID must be alphanumeric only
    public class CustomEndpoint {
        
        @ReadOperation
        public Map<String, Object> customInfo() {
            return Map.of("status", "ok");
        }
        
        @WriteOperation
        public void updateSetting(@Selector String name, String value) {
            // Handle update
        }
    }
    ```

    **Validate:**
    - Endpoint ID format compliance
    - Operation annotations are correct
    - Return types are serializable
  links:
    - title: 'Spring Boot Actuator Custom Endpoints'
      url: https://docs.spring.io/spring-boot/docs/3.0.x/reference/html/actuator.html#actuator.endpoints.implementing-custom

- ruleID: spring-boot-2.x-to-3.0-actuator-00030
  category: potential
  effort: 2
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    or:
    - java.referenced:
        pattern: org.springframework.boot.actuate.health.HealthIndicator
        location: IMPLEMENTS_TYPE
    - java.referenced:
        pattern: org.springframework.boot.actuate.health.AbstractHealthIndicator
  description: HealthIndicator implementation updates for Spring Boot 3.0
  message: |
    `HealthIndicator` implementations may need updates for Spring Boot 3.0.

    **Key Changes:**
    - `Health.Builder` API updates
    - Reactive health indicators have new base classes
    - Health groups configuration has changed

    **Example Migration:**
    ```java
    @Component
    public class CustomHealthIndicator implements HealthIndicator {
        
        @Override
        public Health health() {
            // Check health logic
            boolean healthy = checkHealth();
            
            if (healthy) {
                return Health.up()
                    .withDetail("custom", "All systems operational")
                    .build();
            }
            return Health.down()
                .withDetail("custom", "System unavailable")
                .build();
        }
    }
    ```

    **Configuration Updates:**
    ```properties
    # Health groups
    management.endpoint.health.group.custom.include=customHealthIndicator
    management.endpoint.health.group.custom.show-details=always
    ```
  links:
    - title: 'Spring Boot Health Information'
      url: https://docs.spring.io/spring-boot/docs/3.0.x/reference/html/actuator.html#actuator.endpoints.health

- ruleID: spring-boot-2.x-to-3.0-actuator-00040
  category: potential
  effort: 1
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    builtin.filecontent:
      pattern: "management.server.base-path"
      filePattern: "application*.properties"
  description: Actuator base path configuration review
  message: |
    The actuator base path configuration may need review in Spring Boot 3.0.

    **Property Changes:**
    - `management.server.base-path` sets the base path for management endpoints
    - Default actuator path is still `/actuator`
    - When using a separate management port, paths behave differently

    **Configuration Example:**
    ```properties
    # Management server on separate port
    management.server.port=8081
    management.server.base-path=/management

    # Actuator endpoint path
    management.endpoints.web.base-path=/actuator

    # Full path becomes: http://localhost:8081/management/actuator/health
    ```

    Verify your actuator endpoint paths are correctly configured and accessible.
  links:
    - title: 'Spring Boot Actuator HTTP Endpoints'
      url: https://docs.spring.io/spring-boot/docs/3.0.x/reference/html/actuator.html#actuator.endpoints.exposing

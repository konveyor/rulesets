- ruleID: spring-boot-2.x-to-3.0-core-changes-00001
  category: mandatory
  effort: 1
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    or:
    - builtin.file:
        pattern: "banner.gif"
    - builtin.file:
        pattern: "banner.jpg"
    - builtin.file:
        pattern: "banner.png"
  description: Image banner support removed
  message: |
    Support for image-based application banners has been removed. `banner.gif`, `banner.jpg`,
    and `banner.png` files are now ignored and should be replaced with a text-based `banner.txt` file.

  links:
    - title: 'Spring Boot 3.0 Migration Guide - Core changes'
      url: https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#image-banner-support-removed


- ruleID: spring-boot-2.x-to-3.0-core-changes-00010
  category: mandatory
  effort: 1
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    java.referenced:
      pattern: '*'
      location: CLASS
      annotated:
        pattern: org.springframework.boot.context.properties.ConstructorBinding
  description: "@ConstructorBinding no longer needed at type level"
  message: |
    `@ConstructorBinding` is no longer needed at the type level on `@ConfigurationProperties` classes and should be removed.
    When a class or record has multiple constructors, it may still be used on a constructor to indicate which one should be used for property binding.
    
    If you were relying on autowiring of a dependency into the constructor of a `@ConfigurationProperties` class,
    you must now annotate it with @Autowired to prevent it being identified as a target for property binding.

  links:
    - title: 'Spring Boot 3.0 Migration Guide - Core changes'
      url: https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#constructingbinding-no-longer-needed-at-the-type-level


- ruleID: spring-boot-2.x-to-3.0-core-changes-00020
  category: mandatory
  effort: 3
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    java.referenced:
      pattern: org.springframework.boot.json.YamlJsonParser
  description: YamlJsonParser has been removed in Spring Boot 3.0
  message: |
    The class `YamlJsonParser` has been removed in Spring Boot 3.0 because SnakeYAML's JSON parsing was inconsistent with other parsers.

    If you were using `YamlJsonParser`, switch to one of the other implementations of Spring Boot's `JsonParser` interface:
    - **`JacksonJsonParser`**: Uses Jackson to parse JSON.
    - **`BasicJsonParser`**: Provides a simple, lightweight JSON parser (less commonly used).

    For example:
    - Using `JacksonJsonParser`:
      ```
      JsonParser parser = new JacksonJsonParser();
      Map<String, Object> jsonMap = parser.parseMap(jsonInputString);
      ```
    - Using `BasicJsonParser`:
      ```
      JsonParser parser = new BasicJsonParser();
      Map<String, Object> jsonMap = parser.parseMap(jsonInputString);
      ```

    Ensure to update all usages of `YamlJsonParser` to a supported `JsonParser` implementation.

  links:
    - title: 'Spring Boot 3.0 migration guide'
      url: https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#yamljsonparser
    - title: 'JacksonJsonParser Documentation'
      url: https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/json/JacksonJsonParser.html
    - title: 'BasicJsonParser Documentation'
      url: https://docs.spring.io/spri


- ruleID: spring-boot-2.x-to-3.0-core-changes-00030
  category: mandatory
  effort: 1
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    builtin.file:
      pattern: "spring.factories"
  description: "Autoconfiguration mechanism has changed"
  message: |
    In Spring Boot 3.0, the `spring.factories` file can no longer be used to register
    auto-configuration classes under the `EnableAutoConfiguration` key. Instead, these classes
    must be listed in the new `AutoConfiguration.imports` file.

    Please migrate the entries as follows:

    1. Identify all auto-configuration classes listed under the `EnableAutoConfiguration` key in `spring.factories`.
    2. Create a new file: `META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports`.
    3. Copy the auto-configuration class entries into the `AutoConfiguration.imports` file.
    4. Remove or comment out the `EnableAutoConfiguration` key and its entries from `spring.factories`.

    If your library must support both Spring Boot 2.x and 3.x, you can list the classes in both files.
    Spring Boot 2.7 will handle this gracefully by deduplicating entries.
  links:
    - title: "Spring Boot 3.0 Migration Guide - Autoconfiguration files"
      url: "https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#auto-configuration-files"

- ruleID: spring-boot-2.x-to-3.0-core-changes-00040
  category: optional
  effort: 1
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    or:
    - builtin.file:
        pattern: "pom.xml"
    - builtin.file:
        pattern: "build.gradle"
  description: Consider using the Spring Boot Properties Migrator
  message: |
    Spring Boot 3.0 has renamed or removed many configuration properties. To help identify
    properties that need to be updated, add the `spring-boot-properties-migrator` module
    to your project temporarily.

    **Maven:**
    ```xml
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-properties-migrator</artifactId>
        <scope>runtime</scope>
    </dependency>
    ```

    **Gradle:**
    ```groovy
    runtime 'org.springframework.boot:spring-boot-properties-migrator'
    ```

    Once added, the migrator will:
    - Analyze your `application.properties` or `application.yml` at runtime
    - Log warnings for deprecated properties
    - Temporarily migrate properties at runtime where possible

    **Important:** Remove this dependency after completing the migration, as it is intended
    for development use only and adds startup overhead.
  links:
    - title: 'Spring Boot 3.0 Migration Guide - Configuration Properties'
      url: https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#configuration-properties-migration

- ruleID: spring-boot-2.x-to-3.0-core-changes-00050
  category: potential
  effort: 1
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    or:
    - builtin.filecontent:
        pattern: "logging.pattern.dateformat"
        filePattern: "application*.properties"
    - builtin.filecontent:
        pattern: "logging.pattern.dateformat"
        filePattern: "application*.yml"
    - builtin.filecontent:
        pattern: "LOG_DATEFORMAT_PATTERN"
        filePattern: "*.properties"
  description: Logging date format has changed in Spring Boot 3.0
  message: |
    The default date format used in log messages has changed in Spring Boot 3.0.

    **Old format (Spring Boot 2.x):** `yyyy-MM-dd HH:mm:ss.SSS`
    **New format (Spring Boot 3.0):** `yyyy-MM-dd'T'HH:mm:ss.SSSXXX` (ISO-8601)

    The new format includes timezone offset information (e.g., `+00:00` or `Z`).

    **If you need to preserve the old format:**

    Add to `application.properties`:
    ```properties
    logging.pattern.dateformat=yyyy-MM-dd HH:mm:ss.SSS
    ```

    Or set the environment variable:
    ```
    LOG_DATEFORMAT_PATTERN=yyyy-MM-dd HH:mm:ss.SSS
    ```

    **Note:** The new ISO-8601 format is recommended for better interoperability with
    log aggregation systems and international applications.
  links:
    - title: 'Spring Boot 3.0 Migration Guide - Logging Date Format'
      url: https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#logging-date-format

- ruleID: spring-boot-2.x-to-3.0-core-changes-00060
  category: mandatory
  effort: 3
  labels:
    - konveyor.io/source=spring-boot2
    - konveyor.io/target=spring-boot3+
  when:
    or:
    - java.dependency:
        name: javax.servlet.javax.servlet-api
        lowerbound: 0.0.0
    - java.referenced:
        pattern: javax.servlet*
        location: IMPORT
  description: Jakarta EE 9+ is required for Spring Boot 3.0
  message: |
    Spring Boot 3.0 requires Jakarta EE 9 or later. All `javax.*` namespace dependencies
    must be migrated to `jakarta.*`.

    **Key Changes:**
    - `javax.servlet` → `jakarta.servlet`
    - `javax.persistence` → `jakarta.persistence`
    - `javax.validation` → `jakarta.validation`
    - `javax.annotation` → `jakarta.annotation`
    - `javax.transaction` → `jakarta.transaction`

    **Maven Dependency Updates:**
    ```xml
    <!-- Before -->
    <dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>javax.servlet-api</artifactId>
    </dependency>

    <!-- After -->
    <dependency>
        <groupId>jakarta.servlet</groupId>
        <artifactId>jakarta.servlet-api</artifactId>
        <version>6.0.0</version>
    </dependency>
    ```

    **Import Updates:**
    ```java
    // Before
    import javax.servlet.http.HttpServletRequest;
    
    // After
    import jakarta.servlet.http.HttpServletRequest;
    ```

    **Tools to help migration:**
    - OpenRewrite recipes for Jakarta EE migration
    - Eclipse Transformer for binary migration
    - IntelliJ IDEA migration assistance
  links:
    - title: 'Spring Boot 3.0 Migration Guide - Jakarta EE'
      url: https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#jakarta-ee



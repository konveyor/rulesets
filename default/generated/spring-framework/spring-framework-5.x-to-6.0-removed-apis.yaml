- ruleID: spring-framework-5.x-to-6.0-removed-apis-00001
  category: mandatory
  effort: 5
  labels:
  - konveyor.io/source=spring5
  - konveyor.io/target=spring6+
  - konveyor.io/source=spring-boot2
  - konveyor.io/target=spring-boot3+
  when:
    or:
    - java.referenced:
        pattern: org.springframework.cache.ehcache*
        location: IMPORT
    - java.dependency:
        name: net.sf.ehcache.ehcache
        upperbound: 2.10.9.2
  description: Spring Framework 6.0 has dropped support for EhCache 2.x
  message: |
    The org.springframework.cache.ehcache package has been removed as it was providing support for
    Ehcache 2.x - with this version, `net.sf.ehcache` is using Java EE APIs and is about to be End Of Life'd.
    Ehcache 3 is the direct replacement. Please revisit your dependency management to use `org.ehcache:ehcache`
    (with the jakarta classifier) instead and look into the official migration guide or reach out to the ehcache
    community for assistance.
    
    There is no renewed support or helpers for EhCache 3.0 integration anymore, and the `org.springframework.cache.ehcache`
    package has been removed. Instead, you can either use the JCache API (JSR-107) or EhCache 3's native API.
    
    If you want to use the JCache (JSR-107) integration, Spring's caching abstraction allows for it:
    
    1. Enable Caching in Spring as usual:
    ```java
    @Configuration
    @EnableCaching
    public class CacheConfig {
        // CacheManager bean configuration goes here
    }
    ```
    2. Configure a JCache `CacheManager`:
    ```java
    import javax.cache.Caching;
    import javax.cache.spi.CachingProvider;
    import org.springframework.cache.annotation.EnableCaching;
    import org.springframework.cache.jcache.JCacheCacheManager;

    @Configuration
    @EnableCaching
    public class CacheConfig {
        @Bean
        public JCacheCacheManager cacheManager() {
            CachingProvider cachingProvider = Caching.getCachingProvider();
            javax.cache.CacheManager ehCacheManager = cachingProvider.getCacheManager();
            return new JCacheCacheManager(ehCacheManager);
        }
    }
    ```
    
    Additionally, you may need to adapt your Ehcache 2.x XML configuration to be compatible with Ehcache 3.x
    if you were previously using XML-based cache configurations.
    
    For specifics on how to migrate from Ehcache 2 to 3, please check the link provided.
  links:
  - title: 'Spring 6.0 migration guide'
    url: https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-6.0-Release-Notes#removed-apis
  - title: 'Ehcache 2 to 3 migration guide'
    url: https://www.ehcache.org/documentation/3.10/migration-guide.html

- ruleID: spring-framework-5.x-to-6.0-removed-apis-00010
  category: mandatory
  effort: 7
  labels:
  - konveyor.io/source=spring5
  - konveyor.io/target=spring6+
  - konveyor.io/source=spring-boot2
  - konveyor.io/target=spring-boot3+
  when:
    or:
    - java.referenced:
        pattern: org.springframework.remoting.rmi*
    - java.referenced:
        pattern: org.springframework.remoting.httpinvoker*
    - java.referenced:
        pattern: org.springframework.remoting.jaxws*
    - java.referenced:
        pattern: org.springframework.remoting.caucho*
    - java.referenced:
        pattern: org.springframework.jms.remoting*
  description: RPC-style remoting has been removed in Spring 6
  message: |
    RPC-style remoting that has been officially and/or effectively deprecated for several years has been 
    removed in Spring Framework 6.0. This impacts:
    
    - **RMI Remoting** (`org.springframework.remoting.rmi`)
    - **HTTP Invoker** (`org.springframework.remoting.httpinvoker`)
    - **Hessian/Burlap** (`org.springframework.remoting.caucho`)
    - **JAX-WS support** (`org.springframework.remoting.jaxws`)
    - **JMS Invoker** (`org.springframework.jms.remoting`)

    **Migration Guidance:**

    Consider migrating to modern alternatives:
    
    1. **REST APIs** - Use `@RestController` with JSON/XML payloads
    2. **gRPC** - For high-performance RPC needs
    3. **Spring WebFlux** - For reactive communication
    4. **Message Queues** - Use Spring AMQP or Spring Kafka for async messaging

    **Example REST replacement:**
    ```java
    // Before (HTTP Invoker)
    @Bean
    public HttpInvokerProxyFactoryBean userService() {
        HttpInvokerProxyFactoryBean proxy = new HttpInvokerProxyFactoryBean();
        proxy.setServiceUrl("http://server/userService");
        proxy.setServiceInterface(UserService.class);
        return proxy;
    }
    
    // After (REST Client)
    @Bean
    public UserService userService(RestClient.Builder builder) {
        RestClient client = builder.baseUrl("http://server").build();
        return HttpServiceProxyFactory.builderFor(RestClientAdapter.create(client))
            .build().createClient(UserService.class);
    }
    ```
  links:
  - title: 'Spring 6.0 migration guide - Removed APIs'
    url: https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-6.0-Release-Notes#removed-apis
  - title: 'Spring Issue #27422'
    url: https://github.com/spring-projects/spring-framework/issues/27422

- ruleID: spring-framework-5.x-to-6.0-removed-apis-00020
  category: mandatory
  effort: 5
  labels:
  - konveyor.io/source=spring5
  - konveyor.io/target=spring6+
  - konveyor.io/source=spring-boot2
  - konveyor.io/target=spring-boot3+
  when:
    or:
    - java.referenced:
        pattern: org.springframework.ejb.access*
    - java.referenced:
        pattern: org.springframework.ejb.config*
  description: Dedicated EJB access has been removed in Spring 6
  message: |
    Dedicated EJB access support has been removed in Spring Framework 6.0.

    The following packages/classes are no longer available:
    - `org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean`
    - `org.springframework.ejb.access.SimpleRemoteStatelessSessionProxyFactoryBean`
    - `org.springframework.ejb.config` namespace support

    **Migration Guidance:**

    If you need to lookup an EJB, use JNDI directly via `JndiObjectFactoryBean` or `<jee:jndi-lookup>`:

    **Java Configuration:**
    ```java
    @Bean
    public JndiObjectFactoryBean myEjb() {
        JndiObjectFactoryBean factory = new JndiObjectFactoryBean();
        factory.setJndiName("java:comp/env/ejb/MyEjb");
        factory.setExpectedType(MyEjbInterface.class);
        return factory;
    }
    ```

    **XML Configuration:**
    ```xml
    <jee:jndi-lookup id="myEjb" jndi-name="java:comp/env/ejb/MyEjb"
                     expected-type="com.example.MyEjbInterface"/>
    ```

    Alternatively, consider migrating away from EJB entirely to Spring-managed beans or CDI.
  links:
  - title: 'Spring 6.0 migration guide - Removed APIs'
    url: https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-6.0-Release-Notes#removed-apis
